# t4目录模型和结果总结

## 一、分析概述

**分析目标**：比较不同淘汰方法（Elimination Methods）的预测准确性，评估各方法在极端分歧情况下的表现

**主要功能**：
1. 构建Q4输入数据集（从t1、t2_1、t3的输出中整合）
2. 运行重放模拟（Replay Simulation）比较4种淘汰方法
3. 导出方法对比汇总表和诊断信息

**数据处理改进**：
- **投票份额归一化**：自动处理负值并归一化，确保每周总和为1
- **不确定性填充**：使用周中位数→全局中位数→0.5的fallback机制填充缺失的不确定性值
- **数据质量检查**：确保评委分数非负，投票份额有效

---

## 二、四种淘汰方法详解

### 2.1 Rank方法（排名和法）

**原理**：
- 计算每个参赛者的评委排名（judge_rank）和粉丝排名（vote_rank）
- 计算排名和：`sum_rank = judge_rank + vote_rank`
- 淘汰排名和最大的k个参赛者

**公式**：
```
judge_rank = rank(judge_total, ascending=False)
vote_rank = rank(vote_share_hat, ascending=False)
sum_rank = judge_rank + vote_rank
eliminated = top_k_by(sum_rank, descending=True)
```

**特点**：
- 简单直观，直接基于排名
- 不考虑绝对分数差异
- 对极端值不敏感

---

### 2.2 Percent方法（百分比和法）

**原理**：
- 计算评委评分比例：`judge_pct = judge_total / sum(judge_total)`
- 使用粉丝投票份额：`vote_pct = vote_share_hat`
- 计算总分比例：`total_pct = judge_pct + vote_pct`
- 淘汰总分比例最小的k个参赛者

**公式**：
```
judge_pct = judge_total / Σ(judge_total)
vote_pct = vote_share_hat
total_pct = judge_pct + vote_pct
eliminated = bottom_k_by(total_pct)
```

**特点**：
- 考虑绝对分数比例
- 评委和粉丝权重相等（1:1）
- 对分数差异敏感

---

### 2.3 Dynamic+JudgeSave方法（动态权重法）

**原理**：
- 根据评委分数离散度和粉丝投票集中度动态调整权重
- 当评委分数差异大时，增加粉丝权重
- 当粉丝投票集中时，减少粉丝权重
- 使用动态权重计算综合得分

**权重计算公式**：
```python
judge_disp = std(judge_total) / mean(judge_total)  # 评委分数离散度
hhi = Σ(vote_pct²)  # 粉丝投票集中度（HHI指数）

disp_n = norm01(judge_disp)  # 归一化到[0,1]
hhi_n = norm01(hhi)

w_fan = w_base + w_amp * (1 - disp_n) - w_amp * hhi_n
w_fan = clip(w_fan, w_clip[0], w_clip[1])  # 限制在[0.20, 0.80]
w_jdg = 1.0 - w_fan

dynamic_score = w_jdg * judge_pct + w_fan * vote_pct
```

**参数设置**：
- `w_base = 0.50`：基础粉丝权重
- `w_amp = 0.30`：权重调整幅度
- `w_clip = (0.20, 0.80)`：权重范围限制

**特殊规则**（k=1时）：
- 从得分最低的2人中，选择评委分数最低的1人淘汰

**特点**：
- 自适应调整权重
- 考虑评委分数离散度和粉丝投票集中度
- 更灵活，能适应不同情况

---

### 2.4 Uncertainty+Geometric方法（不确定性几何平均法）

**原理**：
- 考虑粉丝投票估计的不确定性（CI宽度）
- 使用几何平均而非算术平均
- 根据不确定性和评委离散度动态调整权重α

**权重计算公式**：
```python
# 粉丝投票不确定性
u_F = mean(rel_ci80)  # 相对CI宽度
c_F = 1 / (1 + u_F)   # 不确定性系数（越小越不确定）

# 评委分数离散度
d_J = std(judge_total) / mean(judge_total)
c_J = d_J / (d_J + tau_judge)  # tau_judge = 0.1

# 动态权重
alpha_t = c_J / (c_J + c_F)  # 评委权重
(1 - alpha_t)  # 粉丝权重
```

**几何平均得分**：
```python
judge_share = judge_total / Σ(judge_total)
fan_share = vote_share_hat / Σ(vote_share_hat)  # 或log变换后归一化

geometric_score = (judge_share^alpha_t) * (fan_share^(1-alpha_t))
```

**特殊规则**（k=1时）：
- 从得分最低的3人中，选择几何得分和粉丝份额都较高的1人"拯救"
- 淘汰剩余的1人

**特点**：
- 考虑估计不确定性
- 使用几何平均，对极端值更稳健
- 动态调整权重，适应不同情况

---

## 三、模型性能对比

### 3.1 整体匹配率（Match Rate）

| 方法 | 匹配率 | 说明 |
|------|--------|------|
| **Percent** | **76.60%** | 最高匹配率 |
| **Uncertainty+Geometric** | **68.09%** | 第二高 |
| **Rank** | **56.38%** | 第三 |
| **Dynamic+JudgeSave** | **54.26%** | 最低 |

**发现**：
- **Percent方法表现最好**，匹配率达到76.60%
- Uncertainty+Geometric方法次之，68.09%
- Rank和Dynamic+JudgeSave方法表现较差，约54-56%
- 各方法之间匹配率差异显著（最大差距约22个百分点）

### 3.2 极端分歧情况下的命中率（Extreme Hit Rate）

| 方法 | 极端命中率 | 说明 |
|------|-----------|------|
| **Uncertainty+Geometric** | **20.90%** | 最高 |
| **Percent** | **19.40%** | 第二高 |
| **Dynamic+JudgeSave** | **14.93%** | 第三 |
| **Rank** | **2.99%** | 最低 |

**发现**：
- 在极端分歧情况下，**Uncertainty+Geometric方法表现最好**（20.90%）
- Percent方法次之（19.40%）
- **Rank方法表现最差**（仅2.99%），说明排名和法不适合处理极端分歧
- 极端分歧情况下，Uncertainty+Geometric和Percent方法表现接近，都明显优于Rank方法

### 3.3 淘汰者的平均排名特征

| 方法 | 平均评委排名 | 平均粉丝排名 | 平均排名差距 |
|------|------------|------------|------------|
| **Dynamic+JudgeSave** | 5.80 | 7.63 | 2.70 |
| **Uncertainty+Geometric** | 6.18 | 7.06 | 3.35 |
| **Rank** | 7.16 | 6.69 | 2.15 |
| **Percent** | 6.33 | 7.10 | 2.97 |

**注**：排名越小越好（排名1为最佳）

**发现**：
- **Dynamic+JudgeSave**：淘汰的参赛者评委排名较低（5.80），但粉丝排名较高（7.63），说明更偏向淘汰评委不认可但粉丝喜欢的
- **Rank**：淘汰的参赛者评委排名和粉丝排名都较高（7.16和6.69），排名差距最小（2.15）
- **Percent**：淘汰的参赛者粉丝排名较高（7.10），说明更偏向淘汰粉丝不喜欢的

### 3.4 样本统计

- **总周数**：188周（有淘汰的周）
- **极端分歧周数**：67周（35.6%）
- **方法差异周数**：105周（55.9%）

---

## 四、方法特点总结

### 4.1 Rank方法

**优点**：
- 简单直观，易于理解
- 计算快速
- 对极端值不敏感

**缺点**：
- 匹配率最低（56.4%）
- 极端分歧情况下表现最差（2.9%）
- 不考虑绝对分数差异

**适用场景**：
- 快速初步筛选
- 数据质量较差时

---

### 4.2 Percent方法

**优点**：
- **匹配率最高**（76.60%）
- 考虑绝对分数比例
- 计算简单
- 表现稳定可靠

**缺点**：
- 评委和粉丝权重固定（1:1），不够灵活
- 极端分歧情况下表现一般（19.40%），略低于Uncertainty+Geometric方法

**适用场景**：
- **标准场景下的首选方法**
- 评委和粉丝重要性相当的情况

---

### 4.3 Dynamic+JudgeSave方法

**优点**：
- 动态调整权重，适应不同情况
- 考虑评委分数离散度和粉丝投票集中度
- 有"拯救"机制（k=1时）

**缺点**：
- 匹配率较低（54.3%）
- 参数需要调优
- 计算复杂度较高

**适用场景**：
- 评委和粉丝重要性需要动态调整的情况
- 需要"拯救"机制的场景

---

### 4.4 Uncertainty+Geometric方法

**优点**：
- **极端分歧情况下表现最好**（20.90%）
- 考虑估计不确定性（使用rel_ci80）
- 使用几何平均，对极端值更稳健
- 匹配率较高（68.09%），仅次于Percent方法
- 动态调整权重（alpha_t），适应不同情况

**缺点**：
- 计算复杂度最高
- 需要不确定性信息（CI宽度），缺失时使用fallback
- 参数需要调优（tau_judge = 0.1）

**适用场景**：
- **极端分歧情况下的首选方法**
- 需要处理不确定性的场景
- 数据质量较好时

---

## 五、关键发现

### 5.1 方法选择建议

1. **标准场景**：使用**Percent方法**
   - 匹配率最高（76.60%）
   - 计算简单
   - 表现稳定
   - 推荐作为默认方法

2. **极端分歧场景**：使用**Uncertainty+Geometric方法**
   - 极端命中率最高（20.90%）
   - 考虑不确定性
   - 对极端值更稳健
   - 在极端分歧周表现优于Percent方法

3. **需要动态调整**：使用**Dynamic+JudgeSave方法**
   - 能根据情况动态调整权重
   - 有"拯救"机制

4. **快速筛选**：使用**Rank方法**
   - 计算最快
   - 但准确率较低

### 5.2 极端分歧情况分析

- **67周存在极端分歧**（占35.6%，在有淘汰的188周中）
- 在极端分歧情况下，各方法表现差异显著：
  - Uncertainty+Geometric：20.90%
  - Percent：19.40%
  - Dynamic+JudgeSave：14.93%
  - Rank：2.99%
- 极端分歧是常见情况，需要专门的方法来处理

**结论**：极端分歧是常见情况，需要专门的方法来处理。

### 5.3 方法差异分析

- **105周存在方法差异**（占55.9%）
- 说明不同方法的选择确实会影响结果
- 需要根据具体情况选择合适的方法

---

## 六、输出文件说明

### 6.1 输入数据文件（data目录）

1. **`Q1_part1_pred_df_active_rows.csv`**：
   - 每周活跃参赛者的预测数据
   - 包含：season, week, celebrity_name, judge_total, vote_share_hat, ranks等

2. **`Q1_part2_elimination_eval_week_df.csv`**：
   - 每周的真实淘汰信息
   - 包含：season, week, true_k, true_elims等

3. **`Q1_part3_uncertainty_unc_result_df.csv`**：
   - 粉丝投票估计的不确定性信息
   - 包含：CI宽度、分位数等

4. **`Q3_all_extreme_disagreement_cases.csv`**：
   - 极端分歧案例
   - 用于分析极端情况

### 6.2 输出结果文件（outputs目录）

1. **`q4_method_summary.csv`**：
   - 方法对比汇总表
   - 包含：匹配率、极端命中率、平均排名等

2. **`q4_replay_df.csv`**：
   - 每周的重放模拟结果
   - 包含：各方法的预测、匹配情况、极端分歧标记等

3. **`q4_debug_df.csv`**：
   - 调试信息
   - 包含：动态权重、几何平均参数等

4. **`q4_diff_weeks.csv`**：
   - 方法差异周
   - 不同方法预测不同的周

5. **`q4_focus_weeks.csv`**：
   - 重点关注周
   - 极端分歧且方法差异的周

---

## 七、方法学特点

### 7.1 稳健性

1. **数据归一化**：
   - 投票份额自动归一化（处理负值、缺失值）
   - 每周总和保证为1
   - 使用uniform fallback处理异常情况

2. **不确定性填充**：
   - 三级fallback机制：周中位数 → 全局中位数 → 0.5
   - 确保Uncertainty+Geometric方法始终有不确定性信息

3. **极端值处理**：
   - 使用几何平均（Uncertainty+Geometric方法）
   - 权重限制（Dynamic+JudgeSave方法限制在[0.20, 0.80]）
   - rank_gap上限限制（避免极端artifact）

4. **特殊规则处理**：
   - k=1时的"拯救"机制（Dynamic+JudgeSave和Uncertainty+Geometric）
   - 处理边界情况（k=0, n=0等）

### 7.2 可解释性

1. **权重透明**：动态权重可追踪
2. **参数明确**：所有参数都有明确含义
3. **结果可复现**：方法确定，结果可复现

### 7.3 灵活性

1. **动态调整**：根据情况调整权重
2. **特殊规则**：k=1时的"拯救"机制
3. **多种方法**：提供4种方法供选择

---

## 八、核心结论

### 8.1 方法性能排名

1. **整体匹配率**：Percent > Uncertainty+Geometric > Rank > Dynamic+JudgeSave
2. **极端分歧命中率**：Uncertainty+Geometric > Percent > Dynamic+JudgeSave > Rank

### 8.2 方法选择建议

- **首选**：Percent方法（标准场景）
- **备选**：Uncertainty+Geometric方法（极端分歧场景）
- **特殊**：Dynamic+JudgeSave方法（需要动态调整）
- **快速**：Rank方法（快速筛选）

### 8.3 关键洞察

1. **极端分歧是常见情况**（35.6%的周存在）
2. **方法选择很重要**（55.9%的周存在方法差异）
3. **需要考虑不确定性**（Uncertainty+Geometric在极端情况下表现最好）
4. **简单方法不一定差**（Percent方法表现最好）


