# t1敏感性分析总结

## 一、敏感性分析目标

**目的**：评估模型对关键超参数（`alpha0` 和 `kappa`）的稳健性

**关键参数**：
- **`alpha0`**：Dirichlet先验的初始浓度参数（控制第一周的先验分布）
- **`kappa`**：动态先验的平滑强度系数（控制相邻周之间的平滑程度）

**评估指标**：
1. **一致性（Consistency）**：估计的粉丝投票能否正确预测淘汰结果
   - `consistency_map`：基于MAP估计的一致性（100%为完美）
   - `consistency_mean`：基于后验均值的一致性（100%为完美）
2. **不确定性（Uncertainty）**：估计的不确定性大小
   - `rel_CI_width_median`：相对置信区间宽度的中位数（越小越好）
3. **计算效率（Efficiency）**：ABC采样的接受率
   - `accept_rate_median`：接受率的中位数（越高越好）
4. **边界清晰度（Margin）**：淘汰边界的清晰程度
   - `margin_median`：MAP估计的边界清晰度中位数（越大越好）

---

## 二、参数网格设计

### 2.1 参数范围

**`alpha0` 网格**：{1.0, 5.0, 20.0}
- `alpha0 = 1.0`：弱先验（接近均匀分布，但更集中）
- `alpha0 = 5.0`：中等先验（默认值，均匀分布）
- `alpha0 = 20.0`：强先验（更集中的先验分布）

**`kappa` 网格**：{10.0, 40.0, 120.0}
- `kappa = 10.0`：弱平滑（相邻周之间变化较大）
- `kappa = 40.0`：中等平滑（默认值）
- `kappa = 120.0`：强平滑（相邻周之间变化很小）

**总组合数**：3 × 3 = **9组参数**

### 2.2 固定参数

所有敏感性分析使用相同的固定参数：
- `n_accept = 500`：目标接受样本数
- `draw_max = 50000`：每周最大抽样次数
- `T = 10000000`：总票数缩放因子
- `seed = 1234`：随机种子（确保可重复性）

---

## 三、主要结果

### 3.1 一致性结果（Consistency）

**关键发现**：

| alpha0 | kappa | consistency_map | consistency_mean |
|--------|-------|-----------------|------------------|
| 1.0    | 10    | **1.0000**      | **1.0000**       |
| 1.0    | 40    | **1.0000**      | **1.0000**       |
| 1.0    | 120   | **1.0000**      | **1.0000**       |
| 5.0    | 10    | **1.0000**      | **1.0000**       |
| 5.0    | 40    | **1.0000**      | **0.9967**       |
| 5.0    | 120   | **1.0000**      | **1.0000**       |
| 20.0   | 10    | **1.0000**      | **1.0000**       |
| 20.0   | 40    | **1.0000**      | **0.9967**       |
| 20.0   | 120   | **1.0000**      | **0.9967**       |

**结论**：
1. ✅ **`consistency_map = 1.0000`**：在所有参数组合下，MAP估计都能100%正确预测淘汰结果
2. ✅ **`consistency_mean`**：在大多数参数组合下为1.0000，仅在部分组合下为0.9967（300/301周正确）
3. ✅ **稳健性极强**：模型对`alpha0`和`kappa`的选择不敏感，在广泛的参数范围内都能保持高一致性

### 3.2 不确定性结果（Relative CI Width）

**关键发现**：

| alpha0 | kappa | rel_CI_width_median |
|--------|-------|---------------------|
| 1.0    | 10    | **2.5685**         |
| 1.0    | 40    | **1.3465**         |
| 1.0    | 120   | **0.7892**         |
| 5.0    | 10    | **2.3068**         |
| 5.0    | 40    | **1.3008**         |
| 5.0    | 120   | **0.7919**         |
| 20.0   | 10    | **2.3164**         |
| 20.0   | 40    | **1.1892**         |
| 20.0   | 120   | **0.7125**         |

**结论**：
1. **`kappa`的影响显著**：
   - `kappa = 10`：相对CI宽度较大（2.3-2.6），不确定性较高
   - `kappa = 40`：相对CI宽度中等（1.2-1.3），不确定性适中
   - `kappa = 120`：相对CI宽度较小（0.7-0.8），不确定性较低
2. **`alpha0`的影响较小**：在相同`kappa`下，不同`alpha0`的相对CI宽度差异不大
3. **权衡关系**：更大的`kappa`（更强的平滑）带来更小的不确定性，但可能过度平滑时间序列变化

### 3.3 接受率结果（Accept Rate）

**关键发现**：

| alpha0 | kappa | accept_rate_median |
|--------|-------|-------------------|
| 1.0    | 10    | **0.1905**        |
| 1.0    | 40    | **0.1923**        |
| 1.0    | 120   | **0.1946**        |
| 5.0    | 10    | **0.1855**        |
| 5.0    | 40    | **0.1888**        |
| 5.0    | 120   | **0.2007**        |
| 20.0   | 10    | **0.1918**        |
| 20.0   | 40    | **0.1886**        |
| 20.0   | 120   | **0.2072**        |

**结论**：
1. **接受率稳定**：所有参数组合下的接受率中位数在18-21%之间，差异很小
2. **`kappa`的轻微影响**：更大的`kappa`通常带来略高的接受率（因为先验更集中，更容易满足约束）
3. **计算效率可接受**：接受率在合理范围内，不会导致计算时间过长

### 3.4 边界清晰度结果（Margin）

**关键发现**：

| alpha0 | kappa | margin_median |
|--------|-------|--------------|
| 1.0    | 10    | **0.0119**   |
| 1.0    | 40    | **0.0092**   |
| 1.0    | 120   | **0.0055**   |
| 5.0    | 10    | **0.0095**   |
| 5.0    | 40    | **0.0083**   |
| 5.0    | 120   | **0.0063**   |
| 20.0   | 10    | **0.0087**   |
| 20.0   | 40    | **0.0089**   |
| 20.0   | 120   | **0.0070**   |

**结论**：
1. **`kappa`的影响**：更大的`kappa`带来更小的边界清晰度（因为更强的平滑可能使边界更模糊）
2. **`alpha0`的影响较小**：在相同`kappa`下，不同`alpha0`的边界清晰度差异不大
3. **整体较小**：所有参数组合下的边界清晰度都较小（<0.012），说明淘汰边界通常很接近

---

## 四、关键发现总结

### 4.1 稳健性结论

1. ✅ **一致性极强**：
   - `consistency_map`在所有参数组合下均为1.0000（100%）
   - `consistency_mean`在大多数参数组合下为1.0000，最低为0.9967（300/301周）
   - **模型对参数选择不敏感，在广泛的参数范围内都能保持高一致性**

2. ✅ **不确定性可控**：
   - 相对CI宽度随`kappa`增加而减小（从2.3-2.6降至0.7-0.8）
   - `alpha0`对不确定性的影响较小
   - **可以通过调整`kappa`来平衡不确定性和时间序列平滑度**

3. ✅ **计算效率稳定**：
   - 接受率在所有参数组合下都稳定在18-21%之间
   - **不会因为参数选择导致计算时间显著增加**

### 4.2 参数选择建议

**默认参数（`alpha0=5.0, kappa=40.0`）的选择理由**：

1. **平衡一致性**：`consistency_map=1.0000`，`consistency_mean=0.9967`（300/301周正确）
2. **平衡不确定性**：相对CI宽度为1.3008，在不确定性和时间序列平滑度之间取得平衡
3. **计算效率**：接受率为0.1888，在合理范围内
4. **边界清晰度**：margin_median为0.0083，与其他参数组合相当

**其他参数组合的适用场景**：

- **`kappa=120`**：如果需要更小的不确定性（更精确的估计），可以增加`kappa`
  - 优点：相对CI宽度更小（0.7-0.8）
  - 缺点：可能过度平滑时间序列变化，边界清晰度更小

- **`kappa=10`**：如果需要更灵活的时间序列变化，可以减小`kappa`
  - 优点：边界清晰度更大（0.0087-0.0119）
  - 缺点：不确定性更大（相对CI宽度2.3-2.6）

- **`alpha0`的影响较小**：在1.0-20.0范围内，`alpha0`对主要指标的影响都不大

---

## 五、如何放入论文

### 5.1 论文中的位置建议

**建议位置**：
1. **主方法部分**：在介绍ABC方法和参数设置后，简要提及进行了敏感性分析
2. **结果部分**：在报告主要结果后，添加"敏感性分析"小节
3. **附录/补充材料**：详细的结果表格和图表可以放在附录中

### 5.2 论文中的表述建议

#### 5.2.1 方法部分（简要提及）

**建议表述**：

> 为了评估模型对关键超参数的稳健性，我们进行了敏感性分析。我们系统地变化了Dirichlet先验的初始浓度参数（`alpha0` ∈ {1.0, 5.0, 20.0}）和动态先验的平滑强度系数（`kappa` ∈ {10.0, 40.0, 120.0}），共9组参数组合。所有敏感性分析使用相同的固定参数（`n_accept=500`, `draw_max=50000`），并评估了模型的一致性、不确定性和计算效率。

#### 5.2.2 结果部分（详细报告）

**建议表述**：

> **敏感性分析结果**：我们评估了模型对关键超参数（`alpha0`和`kappa`）的稳健性。在所有9组参数组合中，基于MAP估计的一致性（`consistency_map`）均为1.0000（100%），表明模型对参数选择不敏感。基于后验均值的一致性（`consistency_mean`）在大多数参数组合下为1.0000，最低为0.9967（300/301周正确）。相对置信区间宽度的中位数随`kappa`增加而减小（从2.3-2.6降至0.7-0.8），而`alpha0`对不确定性的影响较小。接受率在所有参数组合下都稳定在18-21%之间，表明计算效率不受参数选择影响。这些结果表明，模型在广泛的参数范围内都能保持高一致性和合理的计算效率。

#### 5.2.3 表格建议

**Table S1（敏感性分析结果汇总表）**：

| alpha0 | kappa | Consistency (MAP) | Consistency (Mean) | Accept Rate (Median) | Rel. CI Width (Median) | Margin (Median) |
|--------|-------|-------------------|-------------------|---------------------|------------------------|-----------------|
| 1.0    | 10    | 1.0000            | 1.0000            | 0.1905              | 2.5685                 | 0.0119          |
| 1.0    | 40    | 1.0000            | 1.0000            | 0.1923              | 1.3465                 | 0.0092          |
| 1.0    | 120   | 1.0000            | 1.0000            | 0.1946              | 0.7892                 | 0.0055          |
| 5.0    | 10    | 1.0000            | 1.0000            | 0.1855              | 2.3068                 | 0.0095          |
| 5.0    | 40    | 1.0000            | 0.9967            | 0.1888              | 1.3008                 | 0.0083          |
| 5.0    | 120   | 1.0000            | 1.0000            | 0.2007              | 0.7919                 | 0.0063          |
| 20.0   | 10    | 1.0000            | 1.0000            | 0.1918              | 2.3164                 | 0.0087          |
| 20.0   | 40    | 1.0000            | 0.9967            | 0.1886              | 1.1892                 | 0.0089          |
| 20.0   | 120   | 1.0000            | 0.9967            | 0.2072              | 0.7125                 | 0.0070          |

**表格说明**：
- Consistency (MAP)：基于MAP估计的一致性（1.0000为完美）
- Consistency (Mean)：基于后验均值的一致性（1.0000为完美）
- Accept Rate (Median)：ABC采样接受率的中位数
- Rel. CI Width (Median)：相对置信区间宽度的中位数（越小越好）
- Margin (Median)：MAP估计的边界清晰度中位数（越大越好）

#### 5.2.4 图表建议

**Figure S1：Consistency vs kappa（按alpha0分组）**

- X轴：`kappa`（10, 40, 120）
- Y轴：`consistency_mean`
- 多条线：不同`alpha0`（1.0, 5.0, 20.0）
- **关键信息**：展示`kappa`对一致性的影响，以及`alpha0`的影响较小

**Figure S2：Relative CI Width vs kappa（按alpha0分组）**

- X轴：`kappa`（10, 40, 120）
- Y轴：`rel_CI_width_median`
- 多条线：不同`alpha0`（1.0, 5.0, 20.0）
- **关键信息**：展示`kappa`对不确定性的显著影响，以及`alpha0`的影响较小

### 5.3 关键结论的强调

**在论文中应强调的要点**：

1. ✅ **稳健性极强**：模型在广泛的参数范围内都能保持高一致性（`consistency_map=1.0000`）
2. ✅ **参数选择不敏感**：`alpha0`和`kappa`的选择对主要结果（一致性）影响很小
3. ✅ **不确定性可控**：可以通过调整`kappa`来平衡不确定性和时间序列平滑度
4. ✅ **计算效率稳定**：接受率在所有参数组合下都稳定在合理范围内

### 5.4 与主结果的关联

**建议在论文中建立敏感性分析与主结果的关联**：

> 敏感性分析表明，我们报告的主要结果（基于`alpha0=5.0, kappa=40.0`）在广泛的参数范围内都是稳健的。特别是，基于MAP估计的一致性在所有参数组合下均为1.0000，这进一步支持了我们关于模型能够准确估计粉丝投票份额的结论。

---

## 六、输出文件说明

### 6.1 敏感性分析输出文件

1. **`sensitivity_grid.csv`**：完整的敏感性分析结果汇总表（包含所有指标）
2. **`sensitivity_outputs/table_S1.csv`**：论文用的敏感性分析结果表（关键指标）
3. **`sensitivity_outputs/table_S1.md`**：Markdown格式的表格（便于复制到论文）
4. **`sensitivity_outputs/fig_S1_consistency_vs_kappa.png`**：一致性随kappa变化的图表
5. **`sensitivity_outputs/fig_S2_rel_ci_vs_kappa.png`**：相对CI宽度随kappa变化的图表

### 6.2 各参数组合的输出文件

每个参数组合（如`alpha0=5.0_kappa=40.0`）都有独立的输出目录，包含：
- `fan_vote_estimates.csv`：该参数组合下的粉丝投票估计结果
- `weekly_summary.csv`：该参数组合下的每周汇总结果
- `run.log`：运行日志

---

## 七、技术细节

### 7.1 敏感性分析流程

1. **参数网格生成**：系统生成所有`alpha0`和`kappa`的组合
2. **批量运行**：对每个参数组合运行`estimate_fan_votes.py`
3. **结果汇总**：从每个参数组合的输出中提取关键指标
4. **结果分析**：生成汇总表和图表

### 7.2 指标计算方法

- **一致性**：从`weekly_summary.csv`中计算所有周的平均一致性
- **不确定性**：从`fan_vote_estimates.csv`中计算所有估计的相对CI宽度
- **接受率**：从`weekly_summary.csv`中计算所有周的平均接受率
- **边界清晰度**：从`weekly_summary.csv`中计算所有周的MAP估计边界清晰度

---

**生成时间**：2026年1月30日  
**分析工具**：Python (pandas, numpy, matplotlib)  
**代码文件**：
- `run_sensitivity.py`：批量运行敏感性分析
- `analyze_sensitivity.py`：分析敏感性分析结果并生成图表

